"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var s in e=arguments[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};!function(f){var d=!0,t=function(){function t(){this.index=0,this.collection=[],this.rules={required:d,email:d,number:!1,code:!1}}return t.prototype.get_index=function(){var t=this.index;return this.index+=1,t},t.prototype.push_collection=function(t,e){this.collection[t]=e},t.prototype.get_collection=function(t){return this.collection[t]},t.prototype.check_rules=function(t){return this.rules.hasOwnProperty(t)?this.rules[t]:!(!(e=t.match(/^(.*?)_(or|and)_.*$/i))||!this.rules.hasOwnProperty(e[1]))&&this.rules[e[1]];var e},t.prototype.get_method=function(t){switch(t){case"required":return this.check_method_required.bind(this);case"email":return this.check_method_email.bind(this);case"number":return this.check_method_number.bind(this);case"code":return this.check_method_code.bind(this)}return!1},t.prototype.check_method_required=function(t){return t.is('[type="radio"]')||t.is('[type="checkbox"]')?0<t.filter(":checked").length:""!==t.val()},t.prototype.check_method_email=function(t){return/^([a-z0-9_]|\-|\.|\+)+@(([a-z0-9_]|\-)+\.)+[a-z]{2,6}$/.test(t.val()+"")},t.prototype.check_method_number=function(t){var e=t.val()+"",r=e;return(e=(e=e.replace(/[Ａ-Ｚａ-ｚ０-９]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)})).replace(/[^0-9]/g,""))!==r&&(t.val(e),t.is(":focus")&&this.change_caret_pos(t,e)),!0},t.prototype.check_method_code=function(t){var e=t.val()+"",r=e;return(e=(e=(e=e.replace(/[Ａ-Ｚａ-ｚ０-９]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)})).replace(/[−ーー―]/g,"-")).replace(/[^0-9]/g,""))!==r&&(t.val(e),t.is(":focus")&&this.change_caret_pos(t,e)),!0},t.prototype.change_caret_pos=function(t,e){var r=e.length-t.data("before_val").length+t.data("caret_pos");if(void 0!==document.selection){var o=t.get(0).createTextRange();o.move("character",r),o.select()}else try{t.get(0).setSelectionRange(r,r)}catch(t){}},t.prototype.get_caret_pos=function(e){if(void 0!==document.selection){var r=document.selection.createRange(),o=document.createRange();try{o.moveToElementText(e),o.setEndPoint("StartToStart",r)}catch(t){(o=e.createTextRange()).setEndPoint("StartToStart",r)}return e.value.length-o.text.length}try{return e.selectionStart||0}catch(t){return 0}},t.prototype.split_related_rules=function(t){return t.split("_and_").join("_or_").split("_or_").slice(1)},t}(),o=function(){function t(t,e){var r=this;this.index=0,this.error_class="error",this.valid_class="valid",this.initial_error_view=!1,this.on_validate=function(){},this.on_success=function(){},this.on_error=function(){},this.model=new s(t),this.index=e,t.on("submit",function(){return r.set_initial_error_view(!0),r.validate_all(),r.model.get_errors()<=0?(f.isFunction(r.on_success)&&r.on_success(),!0):(f.isFunction(r.on_error)&&r.on_error(r.model.get_error_mes()),!1)})}return t.prototype.init=function(t){t.hasOwnProperty("rules")&&t.rules&&this.set_rules(t.rules),t.hasOwnProperty("messages")&&t.messages&&this.set_messages(t.messages),t.hasOwnProperty("error_class")&&t.error_class&&this.set_error_class(t.error_class),t.hasOwnProperty("valid_class")&&t.valid_class&&this.set_valid_class(t.valid_class),t.hasOwnProperty("initial_error_view")&&t.initial_error_view&&this.set_initial_error_view(t.initial_error_view),t.hasOwnProperty("on_validate")&&t.on_validate&&this.set_on_validate(t.on_validate),t.hasOwnProperty("on_success")&&t.on_success&&this.set_on_success(t.on_success),t.hasOwnProperty("on_error")&&t.on_error&&this.set_on_error(t.on_error),this.set_event(),this.validate_all()},t.prototype.set_rules=function(t){this.model.set_rules(t)},t.prototype.set_messages=function(t){this.model.set_messages(t)},t.prototype.set_error_class=function(t){this.error_class=t},t.prototype.set_valid_class=function(t){this.valid_class=t},t.prototype.set_initial_error_view=function(t){this.initial_error_view=t},t.prototype.set_on_validate=function(t){f.isFunction(t)&&(this.on_validate=t)},t.prototype.set_on_success=function(t){f.isFunction(t)&&(this.on_success=t)},t.prototype.set_on_error=function(t){f.isFunction(t)&&(this.on_error=t)},t.prototype.set_event=function(){var t=this;this.model.get_wrap().find("input,select,textarea").off("keydown.inputfollow").on("keydown.inputfollow",function(){t.validate_before(f(this))}).off("click.inputfollow focus.inputfollow change.inputfollow keyup.inputfollow").on("click.inputfollow focus.inputfollow change.inputfollow keyup.inputfollow",function(){t.validate(f(this))})},t.prototype.validate_before=function(t){!t.data("is_inputfollow")&&t.is(":focus")||t.data("before_val",t.val()+"").data("caret_pos",v.get_caret_pos(t.get(0)))},t.prototype.validate=function(t){t.data("is_inputfollow")&&this.validate_all()},t.prototype.validate_all=function(){var h=this;this.model.set_errors(0),this.model.set_error_mes(""),f.each(this.model.get_target(),function(s,i){var t=h.model.get_rules();if(t.hasOwnProperty(s)){var e=t[s],n=[],a=!0,l=!1,c=null,r=!1,o="inputfollow-error-"+h.index+"-"+s.replace("[]",""),_=h.model.get_wrap().find(".inputfollow-error").filter('[data-target="'+s+'"]');if(_.length&&(r=!0,_.attr("id",o)),i.length)if(f.isArray(e)||f.isPlainObject(e))f.each(e,function(t,e){var r=v.check_rules(e);if(l=!(!l&&!r)&&d,r===d&&n.push(e),!h.check_handler(e,i)&&(a=!1,null===c)){var o=h.model.get_messages();Object.prototype.hasOwnProperty.call(o,s)&&Object.prototype.hasOwnProperty.call(o[s],e)&&(c=o[s][e])}});else{l=v.check_rules(e),a=h.check_handler(e,i),l===d&&n.push(e);var u=h.model.get_messages();Object.prototype.hasOwnProperty.call(u,s)&&Object.prototype.hasOwnProperty.call(u[s],e)&&(c=u[s][e])}if(l===d){var p=h.model.get_target();a?(i.addClass(h.valid_class).removeClass(h.error_class),f.each(n,function(t,e){var r=v.split_related_rules(e);f.each(r,function(t,e){p[e].addClass(h.valid_class).removeClass(h.error_class)})}),r?f("#"+o).text("").addClass("inputfollow-error-empty"):f("#"+o).remove()):(h.model.increment_errors(),r?f("#"+o).text("").addClass("inputfollow-error-empty"):f("#"+o).remove(),null!==c&&(h.model.push_error_mes(c),(i.data("is_focused")||h.initial_error_view)&&(r?f("#"+o).removeClass("inputfollow-error-empty").text(c):i.eq(0).after(f("<span>",{id:o,class:"inputfollow-error"}).text(c)),i.removeClass(h.valid_class).addClass(h.error_class),f.each(n,function(t,e){var r=v.split_related_rules(e);f.each(r,function(t,e){p[e].removeClass(h.valid_class).addClass(h.error_class)})}))))}}}),f.isFunction(this.on_validate)&&this.on_validate()},t.prototype.get_errors=function(){return this.model.get_errors()},t.prototype.check_handler=function(t,e){var r,o=v.get_method(t);if(!1!==o)return o(e);var s=this.model.get_target();if(r=t.match(/^(.*?)_or_.*$/i)){if(!1!==(o=v.get_method(r[1]))){var i=o(e),n=t.split("_or_").slice(1);return f.each(n,function(t,e){s.hasOwnProperty(e)&&(i=i||o(s[e]))}),i}}else if((r=t.match(/^(.*?)_and_(.*)$/i))&&!1!==(o=v.get_method(r[1]))){var a=o(e);n=t.split("_and_").slice(1);return f.each(n,function(t,e){s.hasOwnProperty(e)&&(a=a&&o(s[e]))}),a}return!0},t.prototype.reset=function(){this.model.reset_rules(),this.set_event(),this.validate_all()},t}(),s=function(){function t(t){this.errors=0,this.error_mes="",this.rules={},this.target={},this.messages={},this.wrap=t}return t.prototype.get_wrap=function(){return this.wrap},t.prototype.get_target=function(){return this.target},t.prototype.set_rules=function(t){this.rules=__assign({},t),this.reset_rules()},t.prototype.get_rules=function(){return this.rules},t.prototype.set_errors=function(t){this.errors=t},t.prototype.increment_errors=function(t){void 0===t&&(t=1),this.errors+=t},t.prototype.get_errors=function(){return this.errors},t.prototype.set_error_mes=function(t){this.error_mes=t},t.prototype.push_error_mes=function(t){this.error_mes+="\n"+t},t.prototype.get_error_mes=function(){return this.error_mes},t.prototype.set_messages=function(t){this.messages=__assign({},t)},t.prototype.get_messages=function(){return this.messages},t.prototype.reset_rules=function(){var i=this;this.wrap.find("input, select, textarea").off("focus.inputfollow_focus");var t=function(t){var r=n.filter_target(t);if(n.target[t]=n.initialize_target(r),f.isArray(n.rules[t])||f.isPlainObject(n.rules[t]))for(var e=0,o=n.rules[t].length;e<o;e+=1){var s=v.split_related_rules(n.rules[t][e]);f.each(s,function(t,e){i.target[e]=i.initialize_target(i.filter_target(e),r)})}else{s=v.split_related_rules(n.rules[t]);f.each(s,function(t,e){i.target[e]=i.initialize_target(i.filter_target(e),r)})}},n=this;for(var e in this.rules)t(e)},t.prototype.enable_focus_flag=function(t){return function(){t.data("is_focused",!0)}},t.prototype.filter_target=function(r){return this.wrap.find("input,select,textarea").filter(function(t,e){return new RegExp("^"+r+"\\[?","i").test(e.getAttribute("name")||"")})},t.prototype.initialize_target=function(t,e){void 0===e&&(e=null);var r=null!==e?e:t;return t.data("is_inputfollow",!0).data("is_focused",!1).off("focus.inputfollow_focus").on("focus.inputfollow_focus",this.enable_focus_flag(r))},t}(),v=new t;f.fn.extend({inputfollow:function(t){if(f(this).length){var e=null;if(f(this).data("inputfollow_id")){r=f(this).data("inputfollow_id");e=v.get_collection(r)}else{var r=v.get_index();f(this).data("inputfollow_id",r),e=new o(f(this),r),v.push_collection(r,e)}return t&&e.init(t),e}}})}(jQuery);