/*!
  jquery.inputfollow.js v2.1.0
  https://github.com/sushat4692/jquery.inputfollow.js#readme
  Released under the MIT License.
*/
!function(){"use strict";var t=!0,e=!1,r=function(){return(r=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var s in e=arguments[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},o=function(){function t(t){this.errors=0,this.error_mes="",this.rules={},this.target={},this.messages={},this.wrap=t}return t.prototype.get_wrap=function(){return this.wrap},t.prototype.get_target=function(){return this.target},t.prototype.set_rules=function(t){this.rules=r({},t),this.reset_rules()},t.prototype.get_rules=function(){return this.rules},t.prototype.set_errors=function(t){this.errors=t},t.prototype.increment_errors=function(t){void 0===t&&(t=1),this.errors+=t},t.prototype.get_errors=function(){return this.errors},t.prototype.set_error_mes=function(t){this.error_mes=t},t.prototype.push_error_mes=function(t){this.error_mes+="\n"+t},t.prototype.get_error_mes=function(){return this.error_mes},t.prototype.set_messages=function(t){this.messages=r({},t)},t.prototype.get_messages=function(){return this.messages},t.prototype.reset_rules=function(){for(var t in this.wrap.find("input, select, textarea").off("focus.inputfollow_focus"),this.rules){var e=this.filter_target(t);if(this.target[t]=this.initialize_target(e),Array.isArray(this.rules[t]))for(var r=0,o=this.rules[t].length;r<o;r+=1){var s=this.rules[t][r];this.reset_rule(s,e)}else{s=this.rules[t];this.reset_rule(s,e)}}},t.prototype.reset_rule=function(t,e){var r=this;Array.isArray(t.with)&&t.with.map((function(t){r.target[t]=r.initialize_target(r.filter_target(t),e)})),t.if&&Object.keys(t.if).map((function(t){r.target[t]=r.initialize_target(r.filter_target(t),e)}))},t.prototype.enable_focus_flag=function(t){return function(){t.data("is_focused",!0)}},t.prototype.filter_target=function(t){return this.wrap.find('input[name="'+t+'"],input[name^="'+t+'["],select[name="'+t+'"],select[name^="'+t+'["],textarea[name="'+t+'"],textarea[name^="'+t+'["]')},t.prototype.initialize_target=function(t,e){void 0===e&&(e=null);var r=null!==e?e:t;return t.data("is_inputfollow",!0).data("is_focused",!1).off("focus.inputfollow_focus").on("focus.inputfollow_focus",this.enable_focus_flag(r))},t}(),s=new(function(){function r(){this.index=0,this.collection=[],this.rules={required:t,email:t,number:e,code:e}}return r.prototype.get_index=function(){var t=this.index;return this.index+=1,t},r.prototype.push_collection=function(t,e){this.collection[t]=e},r.prototype.get_collection=function(t){return this.collection[t]},r.prototype.check_rules=function(t){var e;return null!==(e=this.rules[t.type])&&void 0!==e&&e},r.prototype.get_method=function(t){switch(t){case"required":return this.check_method_required.bind(this);case"email":return this.check_method_email.bind(this);case"number":return this.check_method_number.bind(this);case"code":return this.check_method_code.bind(this)}return!1},r.prototype.check_method_required=function(t){return t.is('[type="radio"]')||t.is('[type="checkbox"]')?t.filter(":checked").length>0:""!==t.val()},r.prototype.check_method_email=function(t){return/^([a-z0-9_]|-|\.|\+)+@(([a-z0-9_]|-)+\.)+[a-z]{2,6}$/.test(t.val()+"")},r.prototype.check_method_number=function(t){var e=t.val()+"",r=e;return(e=(e=e.replace(/[Ａ-Ｚａ-ｚ０-９]/g,(function(t){return String.fromCharCode(t.charCodeAt(0)-65248)}))).replace(/[^0-9]/g,""))!==r&&(t.val(e),t.is(":focus")&&this.change_caret_pos(t,e)),!0},r.prototype.check_method_code=function(t){var e=t.val()+"",r=e;return(e=(e=(e=e.replace(/[Ａ-Ｚａ-ｚ０-９]/g,(function(t){return String.fromCharCode(t.charCodeAt(0)-65248)}))).replace(/[−ーー―]/g,"-")).replace(/[^0-9]/g,""))!==r&&(t.val(e),t.is(":focus")&&this.change_caret_pos(t,e)),!0},r.prototype.change_caret_pos=function(t,e){var r=e.length-t.data("before_val").length+t.data("caret_pos");if(void 0!==document.selection){var o=t.get(0).createTextRange();o.move("character",r),o.select()}else try{t.get(0).setSelectionRange(r,r)}catch(t){}},r.prototype.get_caret_pos=function(t){if(void 0!==document.selection){var e=document.selection.createRange(),r=document.createRange();try{r.moveToElementText(t),r.setEndPoint("StartToStart",e)}catch(o){(r=t.createTextRange()).setEndPoint("StartToStart",e)}return t.value.length-r.text.length}try{return t.selectionStart||0}catch(t){return 0}},r.prototype.split_related_rules=function(t){return t.split("_and_").join("_or_").split("_or_").slice(1)},r}()),i=function(){function r(t,e){var r=this;this.index=0,this.error_class="error",this.valid_class="valid",this.initial_error_view=!1,this.on_validate=function(){},this.on_success=function(){},this.on_error=function(){},this.model=new o(t),this.index=e,t.on("submit",(function(){return r.set_initial_error_view(!0),r.validate_all(),r.model.get_errors()<=0?("function"==typeof r.on_success&&r.on_success(),!0):("function"==typeof r.on_error&&r.on_error(r.model.get_error_mes()),!1)}))}return r.prototype.init=function(t){t.hasOwnProperty("rules")&&t.rules&&this.set_rules(t.rules),t.hasOwnProperty("messages")&&t.messages&&this.set_messages(t.messages),t.hasOwnProperty("error_class")&&t.error_class&&this.set_error_class(t.error_class),t.hasOwnProperty("valid_class")&&t.valid_class&&this.set_valid_class(t.valid_class),t.hasOwnProperty("initial_error_view")&&t.initial_error_view&&this.set_initial_error_view(t.initial_error_view),t.hasOwnProperty("on_validate")&&t.on_validate&&this.set_on_validate(t.on_validate),t.hasOwnProperty("on_success")&&t.on_success&&this.set_on_success(t.on_success),t.hasOwnProperty("on_error")&&t.on_error&&this.set_on_error(t.on_error),this.set_event(),this.validate_all()},r.prototype.set_rules=function(t){this.model.set_rules(t)},r.prototype.set_messages=function(t){this.model.set_messages(t)},r.prototype.set_error_class=function(t){this.error_class=t},r.prototype.set_valid_class=function(t){this.valid_class=t},r.prototype.set_initial_error_view=function(t){this.initial_error_view=t},r.prototype.set_on_validate=function(t){"function"==typeof t&&(this.on_validate=t)},r.prototype.set_on_success=function(t){"function"==typeof t&&(this.on_success=t)},r.prototype.set_on_error=function(t){"function"==typeof t&&(this.on_error=t)},r.prototype.set_event=function(){var t=this;this.model.get_wrap().find("input,select,textarea").off("keydown.inputfollow").on("keydown.inputfollow",(function(){t.validate_before($(this))})).off("click.inputfollow focus.inputfollow change.inputfollow keyup.inputfollow").on("click.inputfollow focus.inputfollow change.inputfollow keyup.inputfollow",(function(){t.validate($(this))}))},r.prototype.validate_before=function(t){!t.data("is_inputfollow")&&t.is(":focus")||t.data("before_val",t.val()+"").data("caret_pos",s.get_caret_pos(t.get(0)))},r.prototype.validate=function(t){t.data("is_inputfollow")&&this.validate_all()},r.prototype.validate_all=function(){var r=this;this.model.set_errors(0),this.model.set_error_mes(""),$.each(this.model.get_target(),(function(o,i){var n=r.model.get_rules();if(n.hasOwnProperty(o)){var a=n[o],l=[],c=!0,u=!1,_=null,p=!1,h="inputfollow-error-"+r.index+"-"+o.replace("[]",""),f=r.model.get_wrap().find(".inputfollow-error").filter('[data-target="'+o+'"]');if(f.length&&(p=!0,f.attr("id",h)),i.length)if(Array.isArray(a))a.map((function(n){var a=s.check_rules(n);if(u=u||a?t:e,a===t&&l.push(n),!r.check_handler(n,i)&&(c=!1,null===_)){var p=r.model.get_messages();Object.prototype.hasOwnProperty.call(p,o)&&Object.prototype.hasOwnProperty.call(p[o],n.type)&&(_=p[o][n.type])}}));else if(a){u=s.check_rules(a),c=r.check_handler(a,i),u===t&&l.push(a);var d=r.model.get_messages();Object.prototype.hasOwnProperty.call(d,o)&&Object.prototype.hasOwnProperty.call(d[o],a.type)&&(_=d[o][a.type])}if(u===t){var y=r.model.get_target();c?(r.toggle_error_visible(i,y,l,c),p?$("#"+h).text("").addClass("inputfollow-error-empty"):$("#"+h).remove()):(r.model.increment_errors(),p?$("#"+h).text("").addClass("inputfollow-error-empty"):$("#"+h).remove(),null!==_&&(r.model.push_error_mes(_),(i.data("is_focused")||r.initial_error_view)&&(p?$("#"+h).removeClass("inputfollow-error-empty").text(_):i.eq(0).after($("<span>",{id:h,class:"inputfollow-error"}).text(_)),r.toggle_error_visible(i,y,l,c))))}}})),"function"==typeof this.on_validate&&this.on_validate()},r.prototype.toggle_error_visible=function(t,e,r,o){var s=this;o?t.addClass(this.valid_class).removeClass(this.error_class):t.removeClass(this.valid_class).addClass(this.error_class),r.map((function(t){Array.isArray(t.with)&&t.with.map((function(t){Object.prototype.hasOwnProperty.call(e,t)&&(o?e[t].addClass(s.valid_class).removeClass(s.error_class):e[t].removeClass(s.valid_class).addClass(s.error_class))})),t.if&&Object.keys(t.if).map((function(t){Object.prototype.hasOwnProperty.call(e,t)&&(o?e[t].addClass(s.valid_class).removeClass(s.error_class):e[t].removeClass(s.valid_class).addClass(s.error_class))}))}))},r.prototype.get_errors=function(){return this.model.get_errors()},r.prototype.check_handler=function(t,e){var r=s.get_method(t.type);if(!1===r)return!0;var o=this.model.get_target();if(t.if){var i=!0;if(Object.keys(t.if).map((function(e){if(t.if&&Object.prototype.hasOwnProperty.call(t.if,e)){var r=t.if[e];if(o.hasOwnProperty(e)){var s=o[e];(s.is('[type="radio"]')||s.is('[type="checkbox"]')?s.filter(":checked").val():o[e].val())==r&&(i=!1)}}})),!0===i)return!0}if(!t.mode&&!t.with)return r(e);if(t.mode&&t.with){if("or"===t.mode.toLowerCase()){var n=r(e);return t.with.map((function(t){o.hasOwnProperty(t)&&(n=n||r(o[t]))})),n}if("and"===t.mode.toLowerCase()){var a=r(e);return t.with.map((function(t){o.hasOwnProperty(t)&&(a=a&&r(o[t]))})),a}}return!0},r.prototype.reset=function(){this.model.reset_rules(),this.set_event(),this.validate_all()},r}();$.fn.extend({inputfollow:function(t){var e=this;if($(e).length){var r;if($(e).data("inputfollow_id")){o=$(e).data("inputfollow_id");r=s.get_collection(o)}else{var o=s.get_index();$(e).data("inputfollow_id",o),r=new i($(e),o),s.push_collection(o,r)}return t&&r&&r.init(t),r}}})}();
